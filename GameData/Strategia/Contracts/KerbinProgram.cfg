// Contract for Kerbin orbital program.
//   Author: fwdixon
//   Attributions: Contracts copied and adapted from Career Evolution Contract Pack by pap1723, Strategia headers taken from Strategia by nightingale
//	 Contract License: CC-BY-NC-SA
//   Strategia License: MIT

CONTRACT_TYPE
{
    name = STG_KerbinProgram
    group = Strategia

    genericTitle = The Home World Program
    genericDescription = This is a Strategia contract that is automatically accepted when the pre-requisite strategy is taken.

    title = @strategy
    description = @strategy.description()
    synopsis = @strategy.synopsis()
    completedMessage = @strategy.completedMessage()

    agent = Strategia

    targetBody = @strategy.targetBody()

    autoAccept = true
    cancellable = false

    maxSimultaneous = 1

    prestige = Exceptional

    // Contract rewards
    advanceFunds = @strategy.advanceFunds() / ContractMultiplier()
    rewardFunds = @strategy.rewardFunds() / ContractMultiplier()
    rewardReputation = @strategy.rewardReputation() / ContractMultiplier()
    failureReputation = @strategy.failureReputation() / ContractMultiplier()
    failureFunds = @strategy.failureFunds() / ContractMultiplier()

    DATA
    {
        type = StrategiaStrategy
        requiredValue = true
        title = The pre-requisite strategy must be taken

        strategy = ActiveStrategies().Where(s => s.contractType() == @name).First()
    }

    DATA
    {
        type = string
        uniquenessCheck = CONTRACT_ALL
        hidden = true

        strategyName = @/strategy.Name()
    }

//	Break the Sound Barrier

    PARAMETER
    {
		name = SoundBarrier
		type = VesselParameterGroup
		title = Break the Sound Barrier
		define = SoundBarrier
		
		completedMessage = I feel the need, the need for speed!
		
		rewardFunds = 2500
		rewardScience = 2
		rewardReputation = 1
		
		disableOnStateChange = false
		
		PARAMETER
		{
			name = NewVessel
			type = NewVessel
			title = Launch a New Vessel
		}
		PARAMETER
		{
			name = OneCrew
			type = HasCrew
			minCrew = 1
			maxCrew = 99
			title = Have at least 1 crewmember on board
			hideChildren = true
		}
		PARAMETER
		{
			name = BreakSoundBarrier
			type = ReachState
			minSpeed = 343
			situation = FLYING
			title = Fly faster than 343 m/s
			disableOnStateChange = true
			hideChildren = true
		}
		PARAMETER
		{
			name = ReturnHome
			type = ReturnHome
			targetBody = HomeWorld()
			title = Return Home Safely
			hideChildren = true
		}
		PARAMETER
		{
			name = RecoverVessel
			type = RecoverVessel
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
		}
	}
	
// Reach the Upper Atmosphere
	PARAMETER
	{
		name = UpperAtmo
		type = VesselParameterGroup
		title = Reach the Upper Atmosphere
		define = UpperAtmo
		
		rewardFunds = 4000
		rewardScience = 10
		rewardReputation = 2
		
		completedMessage = From that high up you can see the Snack Factory!
		
		completeInSequence = true
		disableOnStateChange = true
		
		PARAMETER
		{
			name = NewVessel
			type = NewVessel
			title = Launch a New Vessel
			hideChildren = true
		}
		PARAMETER
		{
			name = OneCrew
			type = HasCrew
			minCrew = 1
			maxCrew = 99
			title = Have at least 1 crewmember on board
			hideChildren = true
		}
		PARAMETER
		{
			name = UpperAtmo
			type = ReachState
			minAltitude = HomeWorld().FlyingAltitudeThreshold()
			situation = FLYING
			title = Fly higher than @minAltitude
			disableOnStateChange = true
			hideChildren = true
		}
		PARAMETER
		{
			name = ReturnHome
			type = ReturnHome
			targetBody = HomeWorld()
			title = Return Home Safely
			hideChildren = true
			completeInSequence = true
		}
		PARAMETER
		{
			name = RecoverVessel
			type = RecoverVessel
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
		}	
	}
	
// Cross the Karman Line
	PARAMETER
	{
		name = KarmanLineCrew
		type = VesselParameterGroup
		title = Cross the Karman Line
		define = KarmanLineCrew
		
		completedMessage = Space! It does exist!
		
		rewardFunds = 5500
		rewardScience = 10
		rewardReputation = 3
		
		completeInSequence = true
		disableOnStateChange = true	
		
		PARAMETER
		{
			name = NewVessel
			type = NewVessel
			title = Launch a New Vessel
			hideChildren = true
		}
		PARAMETER
		{
			name = OneCrew
			type = HasCrew
			minCrew = 1
			maxCrew = 99
			title = Have at least 1 crewmember on board
			hideChildren = true
		}
		PARAMETER
        {
            name = ReachState
            type = ReachState
            situation = SUB_ORBITAL
			disableOnStateChange = true
			title = Achieve a Sub Orbital trajectory
			disableOnStateChange = true
			hideChildren = true
        }
		PARAMETER
		{
			name = ReturnHome
			type = ReturnHome
			targetBody = HomeWorld()
			title = Return Home Safely
			hideChildren = true
			completeInSequence = true
		}
		PARAMETER
		{
			name = RecoverVessel
			type = RecoverVessel
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
		}		
	}
// Orbit and Return
	PARAMETER
	{
		name = CrewedOrbit
		type = VesselParameterGroup
		title = Kerbal in Orbit
		define = CrewedOrbit

		completedMessage = Hey Bob, you gotta try this!
		
		rewardFunds = 9000
		rewardScience = 10
		rewardReputation = 5
		
		completeInSequence = true
		disableOnStateChange = true	
		
		PARAMETER
		{
			name = NewVessel
			type = NewVessel
			title = Launch a New Vessel
			hideChildren = true	
		}
		PARAMETER
		{
			name = OneCrew
			type = HasCrew
			minCrew = 1
			maxCrew = 99
			title = Have at least 1 crewmember on board
			hideChildren = true
			disableOnStateChange = true
		}
		PARAMETER
		{
			name = Orbit
			type = Orbit
			targetBody = HomeWorld()
			minAltitude = @targetBody.AtmosphereAltitude()
			title = Reach Orbit
			disableOnStateChange = true
			hideChildren = true
		}
		PARAMETER
		{
			name = OneDay
			type = Duration
			duration = 1d
			preWaitText = Waiting to reach orbit
			waitingText = Orbiting for @duration
			completionText = Orbits Complete! You may fire retros when ready
			disableOnStateChange = true
		}
		PARAMETER
		{
			name = ReturnHome
			type = ReturnHome
			targetBody = HomeWorld()
			title = Return Home Safely
			hideChildren = true
			completeInSequence = true
		}
		PARAMETER
		{
			name = RecoverVessel
			type = RecoverVessel
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
		}
	}
}
